#!/usr/bin/env python3

import os
import sys
import argparse as ap

parser=ap.ArgumentParser()
parser.add_argument("path", help="Path of the file to work on")
parser.add_argument("choice", choices=["extract","embed"], help="Choice to work on file")
parser.add_argument("-c", "--custom", action="store_true", help="Select custom embedding method only for images")

group=parser.add_mutually_exclusive_group()
group.add_argument("-v", "--verbose", action="store_true")
group.add_argument("-q", "--quiet", action="store_true")

args=parser.parse_args()

image_true=False
audio_true=False
video_true=False

with open(args.path, "rb") as file:
    magic_numbers=file.read(16)
    
    image_prefixes=(b"\x25\x62\x69\x74\x6D\x61\x70", b"\x38\x42\x50\x53", b"\x00\x00\x00\x0C\x6A\x50\x20\x20", b"\x47\x49\x46\x38", b"\x47\x50\x41\x54", b"\x4A\x47\x03\x0E", b"\x4D\x53\x57\x49\x4D", b"\x58\x50\x44\x53", b"\x4E\x49\x54\x46\x30", b"\x50\x41\x58", b"\x53\x43\x4D\x49", b"\x80\x2A\x5F\xD7", b"\x89\x50\x4E\x47\x0D\x0A\x1A\x0A", b"\x01\xDA\x01\x01\x00\x03", b"\x0C\xED", b"\x42\x4D", b"\x47\x58\x32", b"\x49\x20\x49", b"\x49\x49\x1A\x00\x00\x00\x48\x45", b"\x49\x49\x2A\x00", b"\x4A\x47\x04\x0E", b"\x01\xFF\x02\x04\x03\x02", b"\x23\x3F\x52\x41\x44\x49\x41\x4E", b"\x4D\x4D\x00\x2A", b"\x50\x49\x43\x54\x00\x08", b"\x76\x2F\x31\x01", b"\x4D\x4D\x00\x2B", b"\x50\x35\x0A", b"\xFF\xD8", b"\x53\x44\x50\x58", b"\x67\x69\x6d\x70\x20\x78\x63\x66", b"\x73\x72\x63\x64\x6F\x63\x69\x64", b"\xEB\x3C\x90\x2A", b"\xAB\x4B\x54\x58\x20\x31\x31\xBB\x0D\x0A\x1A\x0A", b"\xFF\xD8\xFF", b"\x97\x4A\x42\x32\x0D\x0A\x1A\x0A", b"\x00\x00\x00\x00\x14\x00\x00\x00", b"\x38\x42\x50\x53")

    audio_prefixes=(b"\x41\x42\x6F\x78", b"\x5B\x70\x6C\x61\x79\x6C\x69\x73\x74\x5D", b"\x03\x64\x73\x73", b"\x7E\x74\x2C\x01\x50\x70\x02\x4D\x52", b"\xFF\xF1", b"\xFF\xF9", b"\x00\x00\x00\x20\x66\x74\x79\x70\x4D\x34\x41", b"\x23\x21\x53\x49\x4C\x4B\x0A", b"\x2E\x73\x6E\x64", b"\x44\x53\x44\x20", b"\x46\x4F\x52\x4D\x00", b"\x49\x44\x33", b"\x2E\x52\x4D\x46\x00\x00\x00\x12", b"\x46\x4F\x52\x4D\x00", b"\x53\x43\x48\x6C", b"\x80\x00\x00\x20\x03\x12\x04", b"\x57\x41\x56\x45\x66\x6D\x74\x20", b"\x64\x6E\x73\x2E", b"\x66\x4C\x61\x43\x00\x00\x00\x22", b"\x2E\x72\x61\xFD\x00", b"\x30\x26\xB2\x75\x8E\x66\xCF\x11", b"\x4D\x5A", b"\x63\x61\x66\x66", b"\x66\x74\x79\x70\x4D\x34\x41\x20")

    video_prefixes=(b"\x01\x00\x02\x00", b"\x23\x4E\x42\x46", b"\xEF\xBB\xBF\x3C\x3F\x78\x6D\x6C\x20\x76\x65\x72\x73\x69\x6F\x6E", b"\x00\x00\x00\x18\x66\x74\x79\x70", b"\x00\x00\x00\x20\x66\x74\x79\x70\x4D\x34\x41", b"\x45\x4E\x54\x52\x59\x56\x43\x44", b"\x00\x00\x00\x1C\x66\x74\x79\x70", b"\x00\x00\x01\xBA", b"\x46\x4C\x56", b"\x50\x61\x56\x45", b"\x52\x49\x46\x46", b"\x00\x00\x01\xB3", b"\x30\x26\xB2\x75\x8E\x66\xCF\x11", b"\x47\x65\x6E\x65\x74\x65\x63\x20\x4F\x6D\x6E\x69\x63\x61\x73\x74", b"\x1A\x45\xDF\xA3", b"\x2E\x52\x45\x43", b"\x66\x74\x79\x70\x4D\x53\x4E\x56", b"\x66\x74\x79\x70\x6D\x70\x34\x32", b"\x52\x49\x46\x46", b"\x66\x74\x79\x70\x33\x67\x70\x35")
    

    if magic_numbers.startswith(image_prefixes):
        image_true=True
    elif magic_numbers.startswith(audio_prefixes) or (magic_numbers.startswith(b'RIFF') and (b'WAVE' in magic_numbers)):
        audio_true=True
    elif magic_numbers.startswith(video_prefixes):
        video_true=True

if image_true:
    if args.custom:
        if args.verbose:
            os.system(f"python3 imagestegcustom.py {args.path} --{args.choice} -v")
        elif args.quiet:
            os.system(f"python3 imagestegcustom.py {args.path} --{args.choice} -q")
        else:
            print("Enter the type of output argument(--quiet or --verbose)")
            print("Aborting")
            sys.exit(1)

    else:
        if args.verbose:
            os.system(f"python3 imagesteg.py {args.path} --{args.choice} -v")
        elif args.quiet:
            os.system(f"python3 imagesteg.py {args.path} --{args.choice} -q")
        else:
            print("Enter the type of output argument(--quiet or --verbose)")
            print("Aborting")
            sys.exit(1)
elif audio_true:
    if args.verbose:
        os.system(f"python3 audiosteg.py {args.path} --{args.choice} -v")
    elif args.quiet:
        os.system(f"python3 audiosteg.py {args.path} --{args.choice} -q")
    else:
        print("Enter the type of output argument(--quiet or --verbose)")
        print("Aborting")
        sys.exit(1)
elif video_true: 
    os.system("python3 videosteg.py --{args.choice}")
else:
    print("Invalid file type given as input")
    sys.exit(1)
